<!DOCTYPE html>
<html lang="en">

<head>
  <!-- Required meta tags always come first -->
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <title>SVG Drag and Drop with Elm | (λx.x) Ben Hanna
</title>
  <link rel="canonical" href="https://benpaulhanna.com/drafts/svg-drag-and-drop-with-elm.html">

  <link rel="alternate" type="application/atom+xml" href="https://benpaulhanna.com/feeds/all.atom.xml" title="Full Atom Feed">
  <link rel="alternate" type="application/atom+xml" href="https://benpaulhanna.com/feeds/blog.atom.xml" title="Categories Atom Feed">


  <link rel="stylesheet" href="https://benpaulhanna.com/theme/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://benpaulhanna.com/theme/css/font-awesome.min.css">
  <link rel="stylesheet" href="https://benpaulhanna.com/theme/css/pygments/default.min.css">
  <link rel="stylesheet" href="https://benpaulhanna.com/theme/css/style.css">


<meta name="description" content="To follow along with this tutorial I recommend building an application with Ellie. In this article I'll demonstrate how you can implement drag and drop with SVG documents in Elm. Getting Started To start things off let's begin with an empty Browser.sandbox. We'll also need to install the elm …">
<script>
  (function(i, s, o, g, r, a, m) {
    i['GoogleAnalyticsObject'] = r;
    i[r] = i[r] || function() {
      (i[r].q = i[r].q || []).push(arguments)
    }, i[r].l = 1 * new Date();
    a = s.createElement(o);
    a.async = 1;
    a.src = g;
    m = s.getElementsByTagName(o)[0];
    m.parentNode.insertBefore(a, m)
  })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');
  ga('create', 'UA-25795278-5', 'auto');
  ga('send', 'pageview');
</script>
</head>

<body>
  <header class="header">
    <div class="container">
      <div class="row">
        <div class="col-sm-12">
          <h1 class="title"><a href="https://benpaulhanna.com/">(λx.x) Ben Hanna</a></h1>
          <p class="text-muted">Software Craftsman and Game Programming Enthusiast</p>
          <ul class="list-inline">
            <li class="list-inline-item"><a href="https://benpaulhanna.com/category/blog.html">Blog</a></li>
            <li class="list-inline-item text-muted">|</li>
            <li class="list-inline-item"><a href="https://benpaulhanna.com/pages/about.html">About</a></li>
            <li class=" list-inline-item text-muted">|</li>
            <li class="list-inline-item"><a class="fa fa-github" href="https://github.com/benthepoet" target="_blank"></a></li>
            <li class="list-inline-item"><a class="fa fa-stack-overflow" href="https://stackoverflow.com/users/8171618/ben-hanna" target="_blank"></a></li>
            <li class="list-inline-item"><a class="fa fa-linkedin" href="https://www.linkedin.com/in/ben-hanna-0a275135" target="_blank"></a></li>
          </ul>
        </div>
      </div>
    </div>
  </header>

  <div class="main">
    <div class="container">
      <h1>SVG Drag and Drop with Elm
</h1>
      <hr>
<article class="article">
  <header>
    <ul class="list-inline">
      <li class="list-inline-item text-muted" title="2018-08-24T15:13:00-04:00">
        <i class="fa fa-clock-o"></i>
        Fri 24 August 2018
      </li>
      <li class="list-inline-item">
        <i class="fa fa-folder-open-o"></i>
        <a href="https://benpaulhanna.com/category/blog.html">Blog</a>
      </li>
    </ul>
  </header>
  <div class="content">
    <p>To follow along with this tutorial I recommend building an application with <a href="https://ellie-app.com">Ellie</a>.</p>
<p>In this article I'll demonstrate how you can implement drag and drop with SVG documents in Elm.</p>
<h1>Getting Started</h1>
<p>To start things off let's begin with an empty <code>Browser.sandbox</code>. We'll also need to install the <code>elm/json</code> and <code>elm/svg</code> packages.</p>
<div class="highlight"><pre><span></span><span class="kn">module </span><span class="nc">Main</span> <span class="nv">exposing</span> <span class="p">(</span><span class="nv">main</span><span class="p">)</span>

<span class="kn">import </span><span class="nc">Browser</span>
<span class="kn">import </span><span class="nc">Svg</span> <span class="nv">exposing</span> <span class="p">(</span><span class="kt">Svg</span><span class="p">)</span>
<span class="kn">import </span><span class="nc">Svg.Attributes</span> <span class="kr">as</span> <span class="kt">Attributes</span>


<span class="kr">type</span> <span class="kt">Msg</span>
    <span class="nf">=</span> <span class="kt">NoOp</span>


<span class="nv">initialModel</span> <span class="nf">=</span> <span class="p">()</span>


<span class="nv">update</span> <span class="nf">:</span> <span class="kt">Msg</span> <span class="nf">-&gt;</span> <span class="kt">Model</span> <span class="nf">-&gt;</span> <span class="kt">Model</span>
<span class="nv">update</span> <span class="nv">msg</span> <span class="nv">model</span> <span class="nf">=</span> 
    <span class="nv">model</span>


<span class="nv">view</span> <span class="nf">:</span> <span class="kt">Model</span> <span class="nf">-&gt;</span> <span class="kt">Svg</span> <span class="kt">Msg</span>
<span class="nv">view</span> <span class="nv">model</span> <span class="nf">=</span>
    <span class="kt">Svg</span><span class="nf">.</span><span class="nv">svg</span> 
        <span class="p">[</span> <span class="kt">Attributes</span><span class="nf">.</span><span class="nv">width</span> <span class="s">&quot;400&quot;</span> 
        <span class="p">,</span> <span class="kt">Attributes</span><span class="nf">.</span><span class="nv">height</span> <span class="s">&quot;400&quot;</span>
        <span class="p">]</span>
        <span class="p">[]</span>


<span class="kr">main </span><span class="nf">:</span> <span class="kt">Program</span> <span class="p">()</span> <span class="kt">Model</span> <span class="kt">Msg</span>
<span class="kr">main </span><span class="nf">=</span>
    <span class="kt">Browser</span><span class="nf">.</span><span class="nv">sandbox</span>
        <span class="p">{</span> <span class="nv">init</span> <span class="nf">=</span> <span class="nv">initialModel</span>
        <span class="p">,</span> <span class="nv">update</span> <span class="nf">=</span> <span class="nv">update</span>
        <span class="p">,</span> <span class="nv">view</span> <span class="nf">=</span> <span class="nv">view</span>
        <span class="p">}</span>
</pre></div>


<p>Add a little bit of CSS so that we can actually see the boundaries of our <code>svg</code> element.</p>
<div class="highlight"><pre><span></span><span class="nt">svg</span> <span class="p">{</span>
    <span class="k">background-color</span><span class="p">:</span> <span class="mh">#eee</span><span class="p">;</span>
    <span class="k">border</span><span class="p">:</span> <span class="mi">2</span><span class="kt">px</span> <span class="kc">solid</span> <span class="mh">#000</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>


<p>At this we have our blank canvas and now we can start the real work.</p>
<h1>Structuring our data</h1>
<p>So before we get into the logic of the program, let's define what our model is going to look like.</p>
<div class="highlight"><pre><span></span><span class="kr">type</span> <span class="kr">alias</span> <span class="kt">Document</span> <span class="nf">=</span>
    <span class="p">{</span> <span class="nv">width</span> <span class="nf">:</span> <span class="kt">Int</span>
    <span class="p">,</span> <span class="nv">height</span> <span class="nf">:</span> <span class="kt">Int</span>
    <span class="p">}</span>


<span class="kr">type</span> <span class="kt">Pointer</span> 
    <span class="nf">=</span> <span class="kt">Dragging</span>
        <span class="p">{</span> <span class="nv">index</span> <span class="nf">:</span> <span class="kt">Int</span>
        <span class="p">,</span> <span class="nv">dx</span> <span class="nf">:</span> <span class="kt">Int</span>
        <span class="p">,</span> <span class="nv">dy</span> <span class="nf">:</span> <span class="kt">Int</span>
        <span class="p">}</span>
    <span class="nf">|</span> <span class="kt">Idle</span>


<span class="kr">type</span> <span class="kt">Shape</span>
    <span class="nf">=</span> <span class="kt">Circle</span>
        <span class="p">{</span> <span class="nv">cx</span> <span class="nf">:</span> <span class="kt">Int</span>
        <span class="p">,</span> <span class="nv">cy</span> <span class="nf">:</span> <span class="kt">Int</span>
        <span class="p">,</span> <span class="nv">r</span> <span class="nf">:</span> <span class="kt">Int</span>
        <span class="p">,</span> <span class="nv">fill</span> <span class="nf">:</span> <span class="kt">String</span>
        <span class="p">}</span>


<span class="kr">type</span> <span class="kr">alias</span> <span class="kt">Model</span> <span class="nf">=</span>
    <span class="p">{</span> <span class="nv">document</span> <span class="nf">:</span> <span class="kt">Document</span>
    <span class="p">,</span> <span class="nv">pointer</span> <span class="nf">:</span> <span class="kt">Pointer</span>
    <span class="p">,</span> <span class="nv">shapes</span> <span class="nf">:</span> <span class="kt">Array</span> <span class="kt">Shape</span>
    <span class="p">}</span>
</pre></div>


<p>We now have three key properties on our model.</p>
<ul>
<li><code>document</code> - Specifies the dimensions of our <code>&lt;svg&gt;</code> element.</li>
<li><code>pointer</code> - Used to track when we're dragging a shape.</li>
<li><code>shapes</code> - A collection of shapes that are contained in the document.</li>
</ul>
<p>For the sake of simplicity we only have one type of shape, but in the end it'll
be fairly trivial to add any ones.</p>
<p>Now let's update our <code>initialModel</code> with some relevant test data.</p>
<div class="highlight"><pre><span></span><span class="nv">initialModel</span> <span class="nf">:</span> <span class="kt">Model</span>
<span class="nv">initialModel</span> <span class="nf">=</span> 
    <span class="p">{</span> <span class="nv">document</span> <span class="nf">=</span>
        <span class="p">{</span> <span class="nv">width</span> <span class="nf">=</span> <span class="mi">400</span>
        <span class="p">,</span> <span class="nv">height</span> <span class="nf">=</span> <span class="mi">400</span>
        <span class="p">}</span>
    <span class="p">,</span> <span class="nv">pointer</span> <span class="nf">=</span> <span class="kt">Idle</span>
    <span class="p">,</span> <span class="nv">shapes</span> <span class="nf">=</span> 
        <span class="kt">Array</span><span class="nf">.</span><span class="nv">fromList</span>
            <span class="p">[</span> <span class="kt">Circle</span> 
                <span class="p">{</span> <span class="nv">cx</span> <span class="nf">=</span> <span class="mi">50</span>
                <span class="p">,</span> <span class="nv">cy</span> <span class="nf">=</span> <span class="mi">50</span>
                <span class="p">,</span> <span class="nv">r</span> <span class="nf">=</span> <span class="mi">40</span> 
                <span class="p">,</span> <span class="nv">fill</span> <span class="nf">=</span> <span class="s">&quot;yellow&quot;</span> 
                <span class="p">}</span> 
            <span class="p">,</span> <span class="kt">Circle</span> 
                <span class="p">{</span> <span class="nv">cx</span> <span class="nf">=</span> <span class="mi">250</span>
                <span class="p">,</span> <span class="nv">cy</span> <span class="nf">=</span> <span class="mi">250</span>
                <span class="p">,</span> <span class="nv">r</span> <span class="nf">=</span> <span class="mi">20</span> 
                <span class="p">,</span> <span class="nv">fill</span> <span class="nf">=</span> <span class="s">&quot;orange&quot;</span>
                <span class="p">}</span> 
            <span class="p">]</span>
    <span class="p">}</span>
</pre></div>


<h1>Add update messages</h1>
<p>Let's define a few messages that we'll use in our <code>update</code> function.</p>
<div class="highlight"><pre><span></span><span class="kr">type</span> <span class="kt">Msg</span>
    <span class="nf">=</span> <span class="kt">MouseDown</span> <span class="kt">Int</span> <span class="kt">Int</span> <span class="kt">Int</span>
    <span class="nf">|</span> <span class="kt">MouseMove</span> <span class="kt">Int</span> <span class="kt">Int</span>
    <span class="nf">|</span> <span class="kt">MouseUp</span>
</pre></div>


<p>Here's how we going to handle each of the messages.</p>
<ul>
<li><code>MouseDown Int Int Int</code> - This will fire when we click on a shape to start dragging it. The positional values will be <code>index</code>, <code>x</code>, and <code>y</code>. These values will be used to set the <code>pointer</code> on our model.</li>
<li><code>MouseMove Int Int</code> - This will fire when the mouse moves within the document. If the <code>pointer</code> is in <code>Dragging</code> state then we'll update the position of the shape being dragged.</li>
<li><code>MouseUp</code> - This will fire to indicate that we've released the mouse button and are no longer dragging a shape.</li>
</ul>
<p>So let's modify our <code>update</code> function to reflect this logic.</p>
<div class="highlight"><pre><span></span><span class="nv">update</span> <span class="nf">:</span> <span class="kt">Msg</span> <span class="nf">-&gt;</span> <span class="kt">Model</span> <span class="nf">-&gt;</span> <span class="kt">Model</span>
<span class="nv">update</span> <span class="nv">msg</span> <span class="nv">model</span> <span class="nf">=</span> 
    <span class="kr">case</span> <span class="nv">msg</span> <span class="kr">of</span>
        <span class="kt">MouseDown</span> <span class="nv">index</span> <span class="nv">x</span> <span class="nv">y</span> <span class="nf">-&gt;</span>
            <span class="p">{</span> <span class="nv">model</span> <span class="nf">|</span> <span class="nv">pointer</span> <span class="nf">=</span> <span class="kt">Dragging</span> <span class="p">{</span> <span class="nv">index</span> <span class="nf">=</span> <span class="nv">index</span><span class="p">,</span> <span class="nv">dx</span> <span class="nf">=</span> <span class="nv">x</span><span class="p">,</span> <span class="nv">dy</span> <span class="nf">=</span> <span class="nv">y</span> <span class="p">}</span> <span class="p">}</span>

        <span class="kt">MouseMove</span> <span class="nv">x</span> <span class="nv">y</span> <span class="nf">-&gt;</span>
            <span class="kr">case</span> <span class="nv">model</span><span class="nf">.</span><span class="nv">pointer</span> <span class="kr">of</span>
                <span class="kt">Idle</span> <span class="nf">-&gt;</span>
                    <span class="nv">model</span>

                <span class="kt">Dragging</span> <span class="p">{</span> <span class="nv">index</span><span class="p">,</span> <span class="nv">dx</span><span class="p">,</span> <span class="nv">dy</span> <span class="p">}</span> <span class="nf">-&gt;</span>
                    <span class="kr">case</span> <span class="kt">Array</span><span class="nf">.</span><span class="nv">get</span> <span class="nv">index</span> <span class="nv">model</span><span class="nf">.</span><span class="nv">shapes</span> <span class="kr">of</span>
                        <span class="kt">Nothing</span> <span class="nf">-&gt;</span>
                            <span class="nv">model</span>

                        <span class="kt">Just</span> <span class="p">(</span><span class="kt">Circle</span> <span class="nv">attributes</span><span class="p">)</span> <span class="nf">-&gt;</span>
                            <span class="kr">let</span>
                                <span class="nv">shape</span> <span class="nf">=</span> <span class="kt">Circle</span> 
                                            <span class="p">{</span> <span class="nv">attributes</span> 
                                                <span class="nf">|</span> <span class="nv">cx</span> <span class="nf">=</span> <span class="nv">x</span> <span class="nf">-</span> <span class="nv">dx</span> <span class="nf">+</span> <span class="nv">attributes</span><span class="nf">.</span><span class="nv">cx</span>
                                                <span class="p">,</span> <span class="nv">cy</span> <span class="nf">=</span> <span class="nv">y</span> <span class="nf">-</span> <span class="nv">dy</span> <span class="nf">+</span> <span class="nv">attributes</span><span class="nf">.</span><span class="nv">cy</span>
                                            <span class="p">}</span>
                            <span class="kr">in</span>
                                <span class="p">{</span> <span class="nv">model</span> 
                                    <span class="nf">|</span> <span class="nv">shapes</span> <span class="nf">=</span> <span class="kt">Array</span><span class="nf">.</span><span class="nv">set</span> <span class="nv">index</span> <span class="nv">shape</span> <span class="nv">model</span><span class="nf">.</span><span class="nv">shapes</span> 
                                    <span class="p">,</span> <span class="nv">pointer</span> <span class="nf">=</span> <span class="kt">Dragging</span> <span class="p">{</span> <span class="nv">index</span> <span class="nf">=</span> <span class="nv">index</span><span class="p">,</span> <span class="nv">dx</span> <span class="nf">=</span> <span class="nv">x</span><span class="p">,</span> <span class="nv">dy</span> <span class="nf">=</span> <span class="nv">y</span><span class="p">}</span>
                                <span class="p">}</span>

        <span class="kt">MouseUp</span> <span class="nf">-&gt;</span>
            <span class="p">{</span> <span class="nv">model</span> <span class="nf">|</span> <span class="nv">pointer</span> <span class="nf">=</span> <span class="kt">Idle</span> <span class="p">}</span>
</pre></div>


<h1>Drawing shapes</h1>
<p>Now we can get to drawing our document. Let's start off by creating a function that
handles rendering a shape.</p>
<div class="highlight"><pre><span></span><span class="nv">shapeView</span> <span class="nf">:</span> <span class="kt">Int</span> <span class="nf">-&gt;</span> <span class="kt">Shape</span> <span class="nf">-&gt;</span> <span class="kt">Svg</span> <span class="kt">Msg</span>
<span class="nv">shapeView</span> <span class="nv">index</span> <span class="p">(</span><span class="kt">Circle</span> <span class="nv">attributes</span><span class="p">)</span> <span class="nf">=</span>
    <span class="kt">Svg</span><span class="nf">.</span><span class="nv">circle</span>
        <span class="p">[</span> <span class="kt">Attributes</span><span class="nf">.</span><span class="nv">cx</span> 
            <span class="nf">&lt;|</span> <span class="kt">String</span><span class="nf">.</span><span class="nv">fromInt</span> <span class="nv">attributes</span><span class="nf">.</span><span class="nv">cx</span>
        <span class="p">,</span> <span class="kt">Attributes</span><span class="nf">.</span><span class="nv">cy</span> 
            <span class="nf">&lt;|</span> <span class="kt">String</span><span class="nf">.</span><span class="nv">fromInt</span> <span class="nv">attributes</span><span class="nf">.</span><span class="nv">cy</span>
        <span class="p">,</span> <span class="kt">Attributes</span><span class="nf">.</span><span class="nv">r</span> 
            <span class="nf">&lt;|</span> <span class="kt">String</span><span class="nf">.</span><span class="nv">fromInt</span> <span class="nv">attributes</span><span class="nf">.</span><span class="nv">r</span>
        <span class="p">,</span> <span class="kt">Attributes</span><span class="nf">.</span><span class="nv">fill</span> <span class="nv">attributes</span><span class="nf">.</span><span class="nv">fill</span>
        <span class="p">,</span> <span class="kt">Attributes</span><span class="nf">.</span><span class="nv">stroke</span> <span class="s">&quot;black&quot;</span>
        <span class="p">,</span> <span class="kt">Attributes</span><span class="nf">.</span><span class="nv">strokeWidth</span> <span class="s">&quot;2&quot;</span>
        <span class="p">,</span> <span class="nv">onMouseDown</span> <span class="nf">&lt;|</span> <span class="kt">MouseDown</span> <span class="nv">index</span>
        <span class="p">]</span>
        <span class="p">[]</span>
</pre></div>


<p>And then let's update our <code>view</code> function to bring it in to the loop.</p>
<div class="highlight"><pre><span></span><span class="nv">view</span> <span class="nf">:</span> <span class="kt">Model</span> <span class="nf">-&gt;</span> <span class="kt">Svg</span> <span class="kt">Msg</span>
<span class="nv">view</span> <span class="nv">model</span> <span class="nf">=</span>
    <span class="kt">Svg</span><span class="nf">.</span><span class="nv">svg</span> 
        <span class="p">[</span> <span class="kt">Attributes</span><span class="nf">.</span><span class="nv">width</span> 
            <span class="nf">&lt;|</span> <span class="kt">String</span><span class="nf">.</span><span class="nv">fromInt</span> <span class="nv">model</span><span class="nf">.</span><span class="nv">document</span><span class="nf">.</span><span class="nv">width</span>
        <span class="p">,</span> <span class="kt">Attributes</span><span class="nf">.</span><span class="nv">height</span> 
            <span class="nf">&lt;|</span> <span class="kt">String</span><span class="nf">.</span><span class="nv">fromInt</span> <span class="nv">model</span><span class="nf">.</span><span class="nv">document</span><span class="nf">.</span><span class="nv">height</span>
        <span class="p">,</span> <span class="nv">onMouseMove</span> <span class="kt">MouseMove</span>
        <span class="p">,</span> <span class="kt">Events</span><span class="nf">.</span><span class="nv">onMouseUp</span> <span class="kt">MouseUp</span>
        <span class="p">]</span>
        <span class="nf">&lt;|</span> <span class="kt">Array</span><span class="nf">.</span><span class="nv">toList</span> 
        <span class="nf">&lt;|</span> <span class="kt">Array</span><span class="nf">.</span><span class="nv">indexedMap</span> <span class="nv">shapeView</span> <span class="nv">model</span><span class="nf">.</span><span class="nv">shapes</span>
</pre></div>


<h1>Putting it all together</h1>
  </div>
</article>
<hr>
<div id="disqus_thread"></div>
<script>
  var disqus_config = function() {
    this.page.url = 'https://benpaulhanna.com/drafts/svg-drag-and-drop-with-elm.html';
    this.page.identifier = 'svg-drag-and-drop-with-elm';
  };
  (function() {
    var d = document;
    var s = d.createElement('script');
    s.src = '//benpaulhanna.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
  })();
</script>
<noscript class="text-muted">
  Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
</noscript>
    </div>
  </div>

  <footer class="footer">
    <div class="container">
      <div class="row">
       <ul class="col-sm-6 list-inline">
          <li class="list-inline-item"><a href="https://benpaulhanna.com/archives.html">Archives</a></li>
          <li class="list-inline-item"><a href="https://benpaulhanna.com/categories.html">Categories</a></li>
          <li class="list-inline-item"><a href="https://benpaulhanna.com/tags.html">Tags</a></li>
        </ul>
        <p class="col-sm-6 text-sm-right text-muted">
          Generated by <a href="https://github.com/getpelican/pelican" target="_blank">Pelican</a> / <a href="https://github.com/nairobilug/pelican-alchemy" target="_blank">&#x2728;</a>
        </p>
      </div>
    </div>
  </footer>
</body>

</html>